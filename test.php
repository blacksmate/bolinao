
<link href='https://fonts.googleapis.com/css?family=Sancreek' rel='stylesheet' type='text/css'>

<div class="l-container home">
  <div class="illust-container">
    <div class="illust-level illust-level--intro">
      <div class="illustItem illustItem--bgGrass"></div>
      <div class="illustItem illustItem--fencePost illustItem--fencePost--first">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/fencepost.svg" alt="Fence post">
        <div class="illustItem illustItem--northpole illustItem--fence-arrow illustItem--fence-arrow-left symbol symbol--northpole">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/fence-arrow-left.svg" alt="Fence post Arrow Left">
          <h2 class="symbol-title">North Pole </h2>
        </div>
        <div class="illustItem illustItem--grotto illustItem--fence-arrow illustItem--fence-arrow-right symbol symbol--grotto">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/fence-arrow-right.svg" alt="Fence post Arrow Right">
          <h2 class="symbol-title">Grotto</h2>
        </div>
      </div>
      <div class="illustItem illustItem--holly symbol symbol--holly">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/holly.svg" alt="Holly">
      </div>

      <div class="illustItem illustItem--fencePost illustItem--fencePost--second">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/fencepost.svg" alt="Fence post">
        <div class="illustItem illustItem--lapland illustItem--fence-arrow illustItem--fence-arrow-right symbol symbol--lapland">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/fence-arrow-right.svg" alt="Fence post arrow right">
          <h2 class="symbol-title">Lapland</h2>
        </div>
      </div>
      <div class="illustItem illustItem--ivy symbol symbol--ivy">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/ivy.svg" alt="Ivy">
      </div>
    </div>
  </div>
  <div class="illust-level--town">
    <div class="illustItem illustItem--snowglobe">
      <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/snowglobe.svg" alt="Snow Globe">
    </div>
    <div class="illustItem illustItem--town">
      <img class="svg-town" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/town.svg" alt="Town">
      <div class="svg-house">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/house.svg" alt="House">
        <img class="svg-lights" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/lights.svg" alt="lights">
      </div>
      <img class="svg-sleigh" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/sleigh.svg" alt="Sleigh">
      <div class="svg-star inactive">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/star.svg" alt="Star">
      </div>
      <img class="svg-sledge" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/sledge.svg" alt="sledge">
      <img class="svg-robins" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/robins.svg" alt="robins">
      <img class="svg-peace" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/peace.svg" alt="peace">
      <img class="svg-shopping" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/shopping.svg" alt="shopping">
      <div class="svg-carollers">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/carolers.svg" alt="carollers">
      </div>
      <img class="svg-firstfloor" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/firstfloor.svg" alt="firstfloor">
      <img class="svg-secondfloor" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/secondfloor.svg" alt="secondfloor">
      <img class="svg-nativity" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/12207/nativity.svg" alt="nativity">
      
      <div class="illust-level illust-level--symbolsTown">
        <div class="illustItem illustItem--yuletide symbol symbol--yuletide">
          <h2 class="symbol-title">Seasons Greetings</h2>
        </div>
        <div class="symbols--outside">
          <div class="illustItem illustItem--carols symbol symbol--carols">
            <h2 class="symbol-title">Merry Christmas</h2>
          </div>
        </div>
        <div class="symbols--inside inactive">
          <div class="illustItem illustItem--nutcracker symbol symbol--nutcracker">
            <h2 class="symbol-title">Tiny Tim</h2>
          </div>
          <div class="illustItem illustItem--present symbol symbol--present">
            <h2 class="symbol-title">Mum</h2>
          </div>
          <div class="illustItem illustItem--mincepie symbol symbol--mincepie">
            <h2 class="symbol-title">Mince Pies</h2>
          </div>
          <div class="illustItem illustItem--christmascards symbol symbol--christmascards">
            <h2 class="symbol-title">Happy Christmas</h2>
          </div>
          <div class="illustItem illustItem--bingcrosby symbol symbol--bingcrosby">
            <h2 class="symbol-title">Bing Crosby</h2>
          </div>
          <div class="illustItem illustItem--mariahcarey symbol symbol--mariahcarey">
            <h2 class="symbol-title">Mariah Carey</h2>
          </div>
          <div class="illustItem illustItem--endquote">
            <h2 class="symbol-title"><span class="symbol-title-sub">Have</span>a Very Merry Jolly Christmas!</h2>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="scroll-proxy"></div>
  <footer class="page-footer">
    <ul class="unstyled page-footer-links">
      <li><a class="page-footer-info" href="https://twitter.com/AshNolan_" target="_blank">By AshNolan_</a>
      </li>
    </ul>
  </footer>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
    ;(function(KO, $) {

$(function() {

    KO.UI.init();

});


KO.UI = {

    scrollActive: false,

    supports : {
        transform3d: false
    },


    init : function () {
        this.handleZooming();
    },

    handleZooming : function () {

        var zoomContent = $('.illust-container');

        ZUI = new Zoomer(zoomContent);

        //make sure page is at the top when reloaded
        window.scrollTo(0, 0);

    }
};

// the constructor that will do all the work
function Zoomer( content ) {

this.setLevels = function() {

    if (this.docWidth > 1500) {
        this.levels = 6.2;
        this.verticalTranslate = 3000;
    } else if (this.docWidth > 1350) {
        this.levels = 6;
        this.verticalTranslate = 2750;
    } else if (this.docWidth > 1250) {
        this.levels = 5.8;
        this.verticalTranslate = 2450;
    } else if (this.docWidth > 1150) {
        this.levels = 5.7;
        this.verticalTranslate = 2350;
    } else if (this.docWidth > 1050) {
        this.levels = 5.5;
        this.verticalTranslate = 2100;
    } else if (this.docWidth > 950) {
        this.levels = 5.35;
        this.verticalTranslate = 1900;
    } else if (this.docWidth > 850) {
        this.levels = 5.15;
        this.verticalTranslate = 1700;
    } else {
        this.levels = 4.9;
        this.verticalTranslate = 1520;
    }

};



// keep track of DOM
this.content = content;

this.header = $('.page-header');
this.body = $('body');
this.town = $('.illust-level--town');
this.townSymbols = $('.illust-level--symbolsTown');
this.house = $('.svg-house');
this.carollers = $('.svg-carollers');
this.star = $('.svg-star');

// position of vertical scroll
this.scrolled = 0;

var body = document.body,
    html = document.documentElement;

// height of document
this.docHeight = Math.max( body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight );
this.docWidth = html.clientWidth;

// zero-based number of sections
this.setLevels();


// bind Zoomer to scroll event
window.addEventListener( 'scroll', this, false);
}

// enables constructor to be used within event listener
// like obj.addEventListener( eventName, this, false )
Zoomer.prototype.handleEvent = function( event ) {
if ( this[event.type] ) {
    this[event.type](event);
}
};

// triggered every time window scrolls
Zoomer.prototype.scroll = function( event ) {

this.recalculatePositions();

};

Zoomer.prototype.recalculatePositions = function () {

//LETS HAVE SOME DEFAULTS HERE
var INITIAL_TOWN_WIDTH = 350,
    INITIAL_TOWN_HEIGHT = 320,
    TARGET_TOWN_WIDTH = 2800,
    TARGET_TOWN_HEIGHT = 2560,

    TARGET_BG_ZSCALE = 200,

    OFFSET_MARGIN = 80,

    TARGET_VERTICAL_TRANSLATE = 2600;


var supportPageOffset = window.pageXOffset !== undefined;
var isCSS1Compat = ((document.compatMode || "") === "CSS1Compat");

var yOffset = supportPageOffset ? window.pageYOffset : isCSS1Compat ? document.documentElement.scrollTop : document.body.scrollTop;

// normalize scroll value from 0 to 1
this.scrolled = yOffset / ( this.docHeight - window.innerHeight );

var transformValue,
    townTransform,
    symboltransformValue;

this.checkStates();

var scrollFactor = (this.scrolled < 0.5 ? this.scrolled : 0.5);
var scale = Math.pow( 3, scrollFactor * this.levels );
var townHeight = Math.round(scale * INITIAL_TOWN_HEIGHT);
var townWidth = Math.round(scale * INITIAL_TOWN_WIDTH);
var townOffset = Math.round(scale * OFFSET_MARGIN) - OFFSET_MARGIN;

//first half of app is the scale â€“ this zooms into the house
if (scrollFactor < 0.5) {

    var townYPos = Math.round(((townHeight / 2) + townOffset));

    //if we support translate3d
    if (KO.UI.supports.transform3d) {
        transformValue = 'translate3d(0, 0, 0) scale(' + scale + ')';

        townTransform = 'translate3d(-50%, -' + townYPos + 'px, 0)';
        symboltransformValue = 'translate3d(-' + (townWidth / 2) + 'px, -' + townYPos + 'px, 0)' + ' scale(' + scale + ')';
    } else {
        transformValue = 'translate(0, 0) scale(' + scale + ')';

        townTransform = 'translate(-50%, -' + townYPos + 'px)';
        symboltransformValue = 'translate(-' + (townWidth / 2) + 'px, -' + townYPos + 'px)' + ' scale(' + scale + ')';
    }

//the second half is the translate vertically
} else {

    var percentageThroughSection = ((this.scrolled - 0.5) / 0.5); //get the percentage of the amount through the section (on a scale 0-1)
    var verticalTranslate = percentageThroughSection * this.verticalTranslate; //gets a scaled amount dependent on the percentage of the section scrolled through

    var townYPos = Math.round((townHeight / 2) + townOffset - verticalTranslate);

    //if we support translate3d
    if (KO.UI.supports.transform3d) {
        transformValue = 'translate3d(0, 0, 0) scale(' + scale + ')';
        townTransform = 'translate3d(-50%, -' + townYPos + 'px, 0)';
    } else {
        transformValue = 'translate(0, 0) scale(' + scale + ')';
        townTransform = 'translate(-50%, -' + townYPos + 'px)';
    }

}

// SETTING OF OUR NEW VALUES

//update width and height of town
this.town[0].style.width = townWidth + 'px';
this.town[0].style.height = townHeight + 'px';

// //update the transformed value for the town
this.town[0].style.WebkitTransform = townTransform;
this.town[0].style.MozTransform = townTransform;
this.town[0].style.msTransform = townTransform;
this.town[0].style.transform = townTransform;

// //update scale factor of the outside illustrations and text
// if(navigator.userAgent.toLowerCase().indexOf('firefox') === -1) {
    this.content[0].style.WebkitTransform = transformValue;
    this.content[0].style.MozTransform = transformValue;
    this.content[0].style.msTransform = transformValue;
    this.content[0].style.transform = transformValue;
// }

// //town symbols scaling
this.townSymbols[0].style.WebkitTransform = 'scale(' + scale + ')';
this.townSymbols[0].style.MozTransform = 'scale(' + scale + ')';
this.townSymbols[0].style.msTransform = 'scale(' + scale + ')';
this.townSymbols[0].style.transform = 'scale(' + scale + ')';

};


Zoomer.prototype.checkStates = function () {

if (this.scrolled > 0) {
    this.header.addClass('scaled');
} else {
    this.header.removeClass('scaled');
}


//do a test whether to switch to night or not (after 0.25 scrolled)
if (this.scrolled > 0.15) {
    this.body.addClass('night');
} else {
    this.body.removeClass('night');
}

//test between state of movement
if (this.scrolled < 0.5) {

    this.house.removeClass('inactive'); //make house visible
    this.carollers.removeClass('inactive'); //make carollers invisible
    this.star.addClass('inactive'); //make carollers invisible
    this.townSymbols.find('.symbols--inside').addClass('inactive'); //make nativity symbols not visible
    this.townSymbols.find('.symbols--outside').removeClass('inactive'); //make nativity symbols not visible

} else {

    this.house.addClass('inactive'); //make house not visible
    this.carollers.addClass('inactive'); //make carollers invisible
    this.star.removeClass('inactive'); //make carollers invisible
    this.townSymbols.find('.symbols--inside').removeClass('inactive'); //make nativity symbols visible
    this.townSymbols.find('.symbols--outside').addClass('inactive'); //make nativity symbols not visible
}
};


})(window.KO = window.KO || {}, jQuery);

</script>